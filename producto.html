<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Detalle de producto — Nuit Fantôme</title>
  <link rel="stylesheet" href="assets/css/estilos.css">
  <style>
    .breadcrumb{font-size:.9rem;margin:16px 0;color:#666}
    .breadcrumb a{color:#0366d6;text-decoration:none}

    .product-layout{display:grid;grid-template-columns:1.2fr 1fr;gap:24px;align-items:start}
    .product-media{border:1px solid #e5e5e5;border-radius:12px;padding:12px}
    .product-media .main{width:100%;height:460px;object-fit:cover;border-radius:10px;background:#2f2f2f;cursor:zoom-in}
    .thumbs{display:flex;gap:8px;margin-top:10px;flex-wrap:wrap}
    .thumbs img{width:64px;height:64px;object-fit:cover;border-radius:8px;border:2px solid #ddd;cursor:pointer}

    .product-info h1{margin:0 0 6px}
    .product-price{color:#9c27b0;font-weight:700;font-size:1.2rem;margin:6px 0 14px}
    .qty{display:flex;align-items:center;gap:10px;margin:10px 0}
    .qty input{width:80px;padding:8px;border:1px solid #ccc;border-radius:8px;text-align:center}

    .related{margin-top:28px}
    .related h3{margin-bottom:12px}
    .muted{color:#777}

    /* ===== Modal de zoom ===== */
    .zoom-backdrop{position:fixed;inset:0;background:rgba(0,0,0,.7);display:flex;align-items:center;justify-content:center;z-index:60}
    .zoom-box{max-width:min(95vw,1100px);max-height:90vh;background:#111;padding:8px;border-radius:10px}
    .zoom-box img{max-width:100%;max-height:85vh;display:block}

    /* ===== Barra fija móvil añadir ===== */
    .sticky-add{position:fixed;left:0;right:0;bottom:0;background:#fff;border-top:1px solid #eee;padding:10px 12px;display:none;align-items:center;gap:12px;z-index:50}
    .sticky-add .price{font-weight:700;margin-right:auto}
    @media (max-width:900px){.sticky-add{display:flex}}

    @media (max-width:900px){.product-layout{grid-template-columns:1fr}}
  </style>
</head>
<body>
  <header class="header">
    <nav>
      <a href="index.html">Inicio</a>
      <a href="productos.html">Productos</a>
      <a href="blogs.html">Blogs</a>
      <a href="contacto.html">Contacto</a>
    </nav>
    <a href="carrito.html">Cart (<span id="cart-count">0</span>)</a>
  </header>

  <main class="container">
    <div id="bc" class="breadcrumb"></div>

    <section id="detalle" class="product-layout"></section>

    <section class="related">
      <h3>Productos relacionados</h3>
      <div id="relacionados" class="cards"></div>
    </section>

    <section class="related">
      <h3>Vistos recientemente</h3>
      <div id="vistos" class="cards"></div>
    </section>
  </main>

  <!-- Barra fija móvil -->
  <div id="stickyAdd" class="sticky-add">
    <span id="stickyPrice" class="price">$0</span>
    <input id="stickyQty" type="number" min="1" value="1" style="width:82px;padding:8px;border:1px solid #ccc;border-radius:8px;text-align:center">
    <button class="btn" id="stickyBtn">Añadir</button>
  </div>

  <script>
  /* === Catálogo (mismo id y rutas que en productos.html) === */
  const productos = [
    { id:"org01", categoria:"Organizadores", nombre:"Organizador de escritorio blanco", precio:12990, img:"assets/img/organizador.jpg.avif",
      desc:"Organizador metálico con cajón y compartimentos; ideal para notas, lápices y clips." },
    { id:"washi01", categoria:"Cintas / Washi", nombre:"Set 5 washi tape – colores mixtos", precio:3990, img:"assets/img/washi-mix5.jpg",
      desc:"Pack de 5 cintas washi de colores mixtos; papel de arroz, reposicionables, 15 mm x 5 m c/u." },
    { id:"calc01", categoria:"Calculadoras", nombre:"Calculadora compacta pastel", precio:6990, img:"assets/img/calculadora-pastel.jpg",
      desc:"Calculadora compacta con teclas suaves y diseño pastel; pantalla de 12 dígitos." },
    { id:"washi02", categoria:"Cintas / Washi", nombre:"Washi tape ilustrada “Vida diaria”", precio:3490, img:"assets/img/washi-vida-diaria.jpg",
      desc:"Washi ilustrada temática de vida diaria; ideal para diarios y scrap, 15 mm x 5 m." },
    { id:"washi03", categoria:"Cintas / Washi", nombre:"Set de cintas washi – tonos pastel", precio:3990, img:"assets/img/washi-set-pastel.jpg",
      desc:"Set de cintas washi en tonos pastel; adhesivo suave sin residuos, perfecto para bullet journal." },
    { id:"cut01", categoria:"Corte", nombre:"Cúter mini “Paw” (patas de gato)", precio:2990, img:"assets/img/cutter-paw.jpg",
      desc:"Cúter mini con tapa en forma de pata; hoja retráctil segura para papelería y paquetes." },
    { id:"cua03", categoria:"Cuadernos & Libretas", nombre:"Cuaderno ilustrado A5 – Pinturas", precio:4990, img:"assets/img/cuaderno-pinturas.jpg",
      desc:"Cuaderno A5 con ilustraciones; 80 hojas lisas, papel 90 g, tapa dura." },
    { id:"est01", categoria:"Estuches", nombre:"Estuche Sanrio (set 4) ", precio:8990, img:"assets/img/estuche-kuromi.jpg",
      desc:"Estuche Kuromi con compartimentos y cierre resistente; capacidad para 40–60 útiles." },
    { id:"est02", categoria:"Estuches", nombre:"Estuche Sanrio(set 6)", precio:8990, img:"assets/img/estuche-my-melody.jpg",
      desc:"Estuche My Melody con elásticos y bolsillo interno; materiales lavables y durables." },
    { id:"fab01", categoria:"Lápices de grafito", nombre:"Set lápices grafito Faber-Castell", precio:18990, img:"assets/img/faber-castell-set.jpg",
      desc:"Set de lápices de grafito Faber-Castell (HB–2B); incluye borrador y sacapuntas." },
    { id:"gom02", categoria:"Borradores", nombre:"Borrador eléctrico recargable", precio:11990, img:"assets/img/goma-electrica.jpg",
      desc:"Borrador eléctrico recargable por USB; elimina trazos finos sin dañar el papel." },
    { id:"gom01", categoria:"Borradores", nombre:"Borradores degradé (pack 3)", precio:1990, img:"assets/img/gomas-de-colores.jpg",
      desc:"Pack de 3 gomas degradé libres de látex; borra limpio y sin manchas." },
    { id:"lap10", categoria:"Lápices de colores", nombre:"Set lápices de colores – 10 unidades", precio:3990, img:"assets/img/lapices-10.jpg",
      desc:"Set de 10 lápices de color de mina suave; trazo cremoso y colores vibrantes." },
    { id:"lap25", categoria:"Lápices de colores", nombre:"Set lápices de colores – 25 unidades", precio:7990, img:"assets/img/lapices-25.jpg",
      desc:"Set de 25 lápices de color; minas resistentes y mezclables, ideal para ilustración." },
    { id:"lap30", categoria:"Lápices de colores", nombre:"Set lápices de colores – 30 unidades", precio:20000, img:"assets/img/lapices-30.jpg",
      desc:"Set de 30 lápices de color; incluye tonos piel y pasteles, estuche rígido." },
    { id:"pinc01", categoria:"Pinceles / Acuarela", nombre:"Pinceles para acuarela (pack)", precio:8990, img:"assets/img/pinceles-acuarelas.jpg",
      desc:"Pack de pinceles para acuarela con cerdas sintéticas finas y mangos ergonómicos." },
    { id:"post01", categoria:"Notas adhesivas", nombre:"Notas adhesivas Cinnamoroll / Pompompurin", precio:2990, img:"assets/img/postit-cinnamoroll-pompompurin.jpg",
      desc:"Notas adhesivas oficiales Sanrio; papel suave que pega y despega sin residuos." },
    { id:"post02", categoria:"Notas adhesivas", nombre:"Notas adhesivas Kuromi / My Melody", precio:2990, img:"assets/img/postit-kuromi-mymelody.jpg",
      desc:"Notas adhesivas con 3 diseños; perfectas para recordatorios y journaling." },
    { id:"post03", categoria:"Notas adhesivas", nombre:"Notas adhesivas Pochacco / Hello Kitty", precio:2990, img:"assets/img/postit-pochacco-hellokitty.jpg",
      desc:"Notas adhesivas de colores suaves; aprox. 100 hojas por bloc." },
    { id:"saca01", categoria:"Sacapuntas", nombre:"Sacapuntas + borrador 2 en 1", precio:3490, img:"assets/img/sacapuntas-borrador.jpg",
      desc:"Sacapuntas con depósito y borrador integrado; formato compacto para estuche." },
    { id:"bol01", categoria:"Bolígrafos", nombre:"Bolígrafos Sakura gel (pack)", precio:9990, img:"assets/img/sakura-boligrafos.jpg",
      desc:"Bolígrafos Sakura de tinta gel pigmentada; secado rápido y punta 0.5 mm." },
    { id:"set02", categoria:"Sets", nombre:"Set papelería “Gato Azul”", precio:10990, img:"assets/img/set-gato-azul.jpg",
      desc:"Set temático gato azul: stickers, papeles, notas y accesorios combinados." },
    { id:"set01", categoria:"Sets", nombre:"Set papelería “Gato Rosado”", precio:10990, img:"assets/img/set-gato-rosado.jpg",
      desc:"Set temático gato rosado; selección coordinada para journaling y scrap." },
    { id:"washi60", categoria:"Cintas / Washi", nombre:"Set 60 washi tapes", precio:16990, img:"assets/img/set60-cintas.jpg",
      desc:"Mega set de 60 washi tapes variados; anchos y patrones mixtos para proyectos creativos." },
    { id:"clip01", categoria:"Clips / Accesorios", nombre:"Clips decorativos “Click” (pack)", precio:2990, img:"assets/img/set-de-click.jpg",
      desc:"Pack de clips decorativos tipo botón; plástico resistente, colores surtidos." },
    { id:"tij01", categoria:"Tijeras", nombre:"Tijeras My Melody", precio:6990, img:"assets/img/tijeras-my-melody.jpg",
      desc:"Tijeras con funda, filo inoxidable y agarre cómodo; corte suave." },
    { id:"washi04", categoria:"Cintas / Washi", nombre:"Washi tape de flores vintage", precio:3490, img:"assets/img/washi-tape-flores.jpg",
      desc:"Washi tape de flores estilo vintage; ideal para cartas, invitaciones y scrapbooking." }
  ];

  /* === Utils + carrito === */
  const $ = s => document.querySelector(s);
  const toCLP = n => n.toLocaleString('es-CL',{style:'currency',currency:'CLP'});
  const CART_KEY = 'nf_cart';
  const loadCart = () => { try { return JSON.parse(localStorage.getItem(CART_KEY)) || [] } catch { return [] } };
  const saveCart = c => { localStorage.setItem(CART_KEY, JSON.stringify(c)); updateCartCount(); };
  const updateCartCount = () => { const el = $('#cart-count'); if(el) el.textContent = loadCart().reduce((a,b)=>a+b.qty,0); };
  function addToCart(id, qty=1){ const c=loadCart(); const it=c.find(i=>i.id===id); if(it) it.qty+=qty; else c.push({id,qty}); saveCart(c); alert('Producto añadido al carrito'); }

  const getParam = k => new URLSearchParams(location.search).get(k);

  // ====== Vistos recientemente ======
  const SEEN_KEY='nf_seen';
  const loadSeen=()=>{ try{return JSON.parse(localStorage.getItem(SEEN_KEY))||[]}catch{return[]} };
  const saveSeen=a=> localStorage.setItem(SEEN_KEY, JSON.stringify(a.slice(0,20)));

  function renderDetalle(){
    const id = getParam('id');
    const p = productos.find(x=>x.id===id) || productos[0];

    // Migas
    $('#bc').innerHTML = `<a href="index.html">Home</a> › <a href="productos.html">${p.categoria || 'Categoría'}</a> › <span class="muted">${p.nombre}</span>`;

    // Media izquierda
    const media = `
      <div class="product-media">
        ${p.img ? `<img class="main" src="${p.img}" alt="${p.nombre}">` : `<div class="main"></div>`}
        <div class="thumbs">
          ${p.img ? `<img src="${p.img}" alt="thumb">` : ''}
          ${p.img ? `<img src="${p.img}" alt="thumb">` : ''}
          ${p.img ? `<img src="${p.img}" alt="thumb">` : ''}
        </div>
      </div>
    `;

    // Info derecha
    const info = `
      <div class="product-info">
        <h1>${p.nombre}</h1>
        <div class="product-price">${toCLP(p.precio)}</div>
        <p class="muted">${p.desc || 'Descripción del producto.'}</p>

        <div class="qty">
          <label for="qty">Cantidad</label>
          <input id="qty" type="number" min="1" value="1">
        </div>

        <button class="btn" id="addBtnMain">
          Añadir al carrito
        </button>
      </div>
    `;

    $('#detalle').innerHTML = media + info;

    // Eventos añadir
    $('#addBtnMain').addEventListener('click', ()=>{
      const q = parseInt(document.getElementById('qty').value)||1;
      addToCart(p.id, q);
    });

    // ====== Galería: thumbs y zoom ======
    const mainImg = document.querySelector('.product-media .main');
    document.querySelectorAll('.thumbs img').forEach(t=>{
      t.addEventListener('click', ()=>{ if(mainImg) mainImg.src = t.src; });
    });
    if(mainImg && mainImg.tagName==='IMG'){
      mainImg.addEventListener('click', ()=>{
        const back = document.createElement('div');
        back.className = 'zoom-backdrop';
        back.innerHTML = `<div class="zoom-box"><img src="${mainImg.src}" alt=""></div>`;
        back.addEventListener('click', e=>{ if(e.target===back) back.remove(); });
        document.body.appendChild(back);
      });
    }

    // ====== Barra fija móvil ======
    const stickyPrice = document.getElementById('stickyPrice');
    const stickyQty   = document.getElementById('stickyQty');
    const stickyBtn   = document.getElementById('stickyBtn');
    stickyPrice.textContent = toCLP(p.precio);
    stickyQty.value = document.getElementById('qty').value;
    stickyQty.addEventListener('input', ()=>{
      if(+stickyQty.value<1) stickyQty.value=1;
      document.getElementById('qty').value = stickyQty.value;
    });
    document.getElementById('qty').addEventListener('input', ()=>{
      stickyQty.value = document.getElementById('qty').value;
    });
    stickyBtn.addEventListener('click', ()=>{
      addToCart(p.id, parseInt(stickyQty.value)||1);
    });

    // ====== Relacionados (misma categoría) ======
    const relWrap = $('#relacionados'); relWrap.innerHTML='';
    const rel = productos.filter(x=>x.categoria===p.categoria && x.id!==p.id);
    (rel.length?rel:productos.filter(x=>x.id!==p.id)).slice(0,4).forEach(r=>{
      const a = document.createElement('a');
      a.className = 'card';
      a.href = `producto.html?id=${r.id}`;
      a.innerHTML = `
        ${r.img ? `<img src="${r.img}" alt="${r.nombre}" class="ph">` : `<div class="ph"></div>`}
        <div class="title" style="margin-top:6px">${r.nombre}</div>
        <div class="price">${toCLP(r.precio)}</div>
      `;
      relWrap.appendChild(a);
    });

    // ====== Vistos recientemente ======
    const seen = loadSeen().filter(x=>x!==p.id);  // deja primero el actual
    seen.unshift(p.id); saveSeen(seen);

    const vistosWrap = document.getElementById('vistos'); vistosWrap.innerHTML='';
    seen.filter(x=>x!==p.id).slice(0,6)
      .map(id => productos.find(pp=>pp.id===id))
      .filter(Boolean)
      .forEach(r=>{
        const a = document.createElement('a');
        a.className = 'card';
        a.href = `producto.html?id=${r.id}`;
        a.innerHTML = `
          ${r.img ? `<img src="${r.img}" alt="${r.nombre}" class="ph">` : `<div class="ph"></div>`}
          <div class="title" style="margin-top:6px">${r.nombre}</div>
          <div class="price">${toCLP(r.precio)}</div>
        `;
        vistosWrap.appendChild(a);
      });

    return p;
  }

  updateCartCount();
  renderDetalle();
  </script>
</body>
</html>
